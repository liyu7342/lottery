<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fr.lottery.dao.StatisMapper">
  <resultMap id="BaseResultMap" type="com.fr.lottery.dto.StatisDto">
    <id column="gameType" jdbcType="VARCHAR" property="gameType" />
    <result column="no" jdbcType="VARCHAR" property="no" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="orderNum" jdbcType="VARCHAR" property="orderNum" />
    <result column="amount" jdbcType="VARCHAR" property="amount" />
    <result column="winAmount" jdbcType="VARCHAR" property="winAmount" />
    <result column="aveOdds" jdbcType="VARCHAR" property="aveOdds" />
    <result column="odds" jdbcType="DECIMAL" property="odds" />
  </resultMap>

  <select id="getStatis" resultMap="BaseResultMap">
    select gameType,handicapId,`no`,description,COUNT(1) orderNum,SUM(orders.amount) amount,SUM(winAmount) winAmount,sum(odds* orders.amount)/SUM(orders.amount) aveOdds,0 buhuo,0 odds

    (select u1.shareUp from user u1 where u1.parentId ='0459c738b3294b11a9c1b2cf00c469ce'
    AND '0459c738b3294b11a9c1b2cf00c469ce' in(u.DagudongId,u.GudongId,u.ZongdailiId,u.DailiId) ) * od.Amount/100 as  shareTotal
    FROM orders
      INNER  JOIN Handicap on orders.handicapId= Handicap.Id

    INNER JOIN user u on u.id = orders.userId
      <where>
        <if test="handicapId!='' and handicapId!=null" >
          AND handicapId = #{handicapId,jdbcType=VARCHAR}
        </if>
        <if test="gameTypes!=null ">
        AND gameType in
        <foreach item="item" index="index" collection="gameTypes" open="(" separator="," close=")">
          #{item}
        </foreach>
        </if>
        <if test="xpath!=null and xpath !=''">
          AND u.xpath like #{xpath,jdbcType=VARCHAR}
        </if>
      </where>
      GROUP BY handicapId,gameType,`no`

  </select>
  <select id="getStatisSum" resultMap="OrderDetailDtoMap">
    SELECT COUNT (1) as orderNum,SUM(amount) as amount,sum(winAmount)
    select gameType,handicapId,`no`,description,COUNT(1) orderNum,SUM(orders.amount) amount,SUM(winAmount) winAmount,sum(odds* orders.amount)/SUM(orders.amount) aveOdds,0 buhuo,0 odds
    FROM orders
    INNER  JOIN Handicap on orders.handicapId= Handicap.Id
    INNER JOIN user u on u.id = orders.userId
    <where>
      <if test="handicapId!='' and handicapId!=null" >
        AND handicapId = #{handicapId,jdbcType=VARCHAR}
      </if>
      <if test="gameTypes!=null ">
        AND gameType in
        <foreach item="item" index="index" collection="gameTypes" open="(" separator="," close=")">
          #{item}
        </foreach>
      </if>
      <if test="xpath!=null and xpath !=''">
        AND u.xpath like #{xpath,jdbcType=VARCHAR}
      </if>
    </where>
    GROUP BY handicapId,gameType,`no`
  </select>
</mapper>